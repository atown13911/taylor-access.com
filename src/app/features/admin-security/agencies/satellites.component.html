<div class="page-container">
  <div class="page-header">
    <div class="header-text">
      <h1><i class="bx bx-building"></i> Satellites</h1>
      <p>Manage independent franchise locations</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <i class="bx bx-plus"></i> New Satellite
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="search-box">
      <i class="bx bx-search"></i>
      <input 
        type="text" 
        placeholder="Search satellites..." 
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearch()">
    </div>
    
    <select [(ngModel)]="statusFilter" (ngModelChange)="onStatusFilter()">
      <option value="all">All Statuses</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
      <option value="suspended">Suspended</option>
    </select>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-state">
      <i class="bx bx-loader-alt bx-spin"></i>
      <p>Loading satellites...</p>
    </div>
  }

  <!-- Satellites Grid -->
  @if (!loading() && satellites().length > 0) {
    <div class="satellites-grid">
      @for (satellite of satellites(); track satellite.id) {
        <div class="satellite-card" [class]="satellite.status">
          <div class="card-header">
            <div class="satellite-info">
              <h3>{{ satellite.name }}</h3>
              @if (satellite.dbaName) {
                <span class="dba">DBA: {{ satellite.dbaName }}</span>
              }
            </div>
            <span class="status-badge" [class]="satellite.status">{{ satellite.status }}</span>
          </div>

          <div class="card-body">
            @if (satellite.code) {
              <div class="detail-row">
                <i class="bx bx-barcode"></i>
                <span>{{ satellite.code }}</span>
              </div>
            }
            
            @if (satellite.city && satellite.state) {
              <div class="detail-row">
                <i class="bx bx-map"></i>
                <span>{{ satellite.city }}, {{ satellite.state }}</span>
              </div>
            }
            
            @if (satellite.contactPhone) {
              <div class="detail-row">
                <i class="bx bx-phone"></i>
                <span>{{ satellite.contactPhone }}</span>
              </div>
            }
            
            @if (satellite.manager) {
              <div class="detail-row">
                <i class="bx bx-user"></i>
                <span>Manager: {{ satellite.manager.name }}</span>
              </div>
            }
            
            @if (satellite.employeeCount) {
              <div class="detail-row">
                <i class="bx bx-group"></i>
                <span>{{ satellite.employeeCount }} employees</span>
              </div>
            }
          </div>

          <div class="card-actions">
            <button class="btn-icon" (click)="openEditModal(satellite)" title="Edit">
              <i class="bx bx-edit"></i>
            </button>
            <button class="btn-icon btn-danger" (click)="deleteSatellite(satellite.id)" title="Delete">
              <i class="bx bx-trash"></i>
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <button (click)="previousPage()" [disabled]="currentPage() === 1">
        <i class="bx bx-chevron-left"></i> Previous
      </button>
      <span class="page-info">Page {{ currentPage() }} of {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">
        Next <i class="bx bx-chevron-right"></i>
      </button>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && satellites().length === 0) {
    <div class="empty-state">
      <i class="bx bx-building"></i>
      <h3>No satellites found</h3>
      <p>Create your first satellite franchise to get started</p>
      <button class="btn-primary" (click)="openCreateModal()">
        <i class="bx bx-plus"></i> Create Satellite
      </button>
    </div>
  }
</div>

<!-- Create/Edit Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="bx bx-building"></i>
          {{ modalMode() === 'create' ? 'Create Satellite' : 'Edit Satellite' }}
        </h2>
        <button class="btn-close" (click)="closeModal()">
          <i class="bx bx-x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group">
            <label>Satellite Name *</label>
            <input type="text" [(ngModel)]="form().name" placeholder="Chicago Satellite">
          </div>

          <div class="form-group">
            <label>Code</label>
            <input type="text" [(ngModel)]="form().code" placeholder="SAT-CHI">
          </div>

          <div class="form-group">
            <label>DBA Name</label>
            <input type="text" [(ngModel)]="form().dbaName" placeholder="Doing Business As">
          </div>

          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="form().status">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label>Legal Business Name</label>
            <input type="text" [(ngModel)]="form().legalBusinessName">
          </div>

          <div class="form-group">
            <label>EIN/Tax ID</label>
            <input type="text" [(ngModel)]="form().einTaxId" placeholder="XX-XXXXXXX">
          </div>

          <div class="form-group">
            <label>DOT Number</label>
            <input type="text" [(ngModel)]="form().dotNumber">
          </div>

          <div class="form-group">
            <label>MC Number</label>
            <input type="text" [(ngModel)]="form().mcNumber">
          </div>

          <div class="form-group full-width">
            <label>Address</label>
            <input type="text" [(ngModel)]="form().address">
          </div>

          <div class="form-group">
            <label>City</label>
            <input type="text" [(ngModel)]="form().city">
          </div>

          <div class="form-group">
            <label>State</label>
            <input type="text" [(ngModel)]="form().state" placeholder="IL">
          </div>

          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" [(ngModel)]="form().zipCode">
          </div>

          <div class="form-group">
            <label>Contact Name</label>
            <input type="text" [(ngModel)]="form().contactName">
          </div>

          <div class="form-group">
            <label>Contact Email</label>
            <input type="email" [(ngModel)]="form().contactEmail">
          </div>

          <div class="form-group">
            <label>Contact Phone</label>
            <input type="tel" [(ngModel)]="form().contactPhone">
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn-primary" (click)="save()">
          <i class="bx bx-save"></i>
          {{ modalMode() === 'create' ? 'Create' : 'Save Changes' }}
        </button>
      </div>
    </div>
  </div>
}
