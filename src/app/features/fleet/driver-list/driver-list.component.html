<div class="driver-list-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1><i class='bx bx-id-card'></i> Drivers</h1>
      <p class="subtitle">
        @if (fleetName()) {
          Drivers assigned to <strong>{{ fleetName() }}</strong>
        } @else {
          All drivers in your organization
        }
      </p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="loadDrivers()" title="Refresh">
        <i class='bx bx-refresh'></i>
      </button>
      <button class="btn btn-primary" (click)="openAddModal()">
        <i class='bx bx-plus'></i> Add Driver
      </button>
    </div>
  </div>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-icon total"><i class='bx bx-group'></i></div>
      <div class="stat-info">
        <span class="stat-value">{{ stats().total }}</span>
        <span class="stat-label">Total Drivers</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon active"><i class='bx bx-check-circle'></i></div>
      <div class="stat-info">
        <span class="stat-value">{{ stats().active }}</span>
        <span class="stat-label">Active</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon dispatched"><i class='bx bx-navigation'></i></div>
      <div class="stat-info">
        <span class="stat-value">{{ stats().dispatched }}</span>
        <span class="stat-label">Dispatched</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon off-duty"><i class='bx bx-moon'></i></div>
      <div class="stat-info">
        <span class="stat-value">{{ stats().offDuty }}</span>
        <span class="stat-label">Off Duty</span>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="driver-tabs">
    <button class="driver-tab" [class.active]="activeTab() === 'active'" (click)="activeTab.set('active')">
      <i class='bx bx-check-circle'></i> Active <span class="driver-tab-count">{{ tabCounts().active }}</span>
    </button>
    <button class="driver-tab" [class.active]="activeTab() === 'inactive'" (click)="activeTab.set('inactive')">
      <i class='bx bx-pause-circle'></i> Inactive <span class="driver-tab-count">{{ tabCounts().inactive }}</span>
    </button>
    <button class="driver-tab" [class.active]="activeTab() === 'archived'" (click)="activeTab.set('archived')">
      <i class='bx bx-archive'></i> Archived <span class="driver-tab-count">{{ tabCounts().archived }}</span>
    </button>
  </div>

  <!-- Search -->
  <div class="search-bar">
    <i class='bx bx-search'></i>
    <input type="text" placeholder="Search by name, phone, email, license..." [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)">
  </div>

  <!-- Loading -->
  @if (isLoading()) {
    <div class="loading-state">
      <i class='bx bx-loader-alt bx-spin'></i>
      <p>Loading drivers...</p>
    </div>
  } @else if (filteredDrivers().length === 0) {
    <div class="empty-state">
      <i class='bx bx-id-card'></i>
      <h3>No drivers found</h3>
      <p>No drivers match your current filters.</p>
    </div>
  } @else {
    <!-- Table -->
    <div class="data-table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>License #</th>
            <th>License Exp</th>
            <th>Type</th>
            <th>Fleet</th>
            <th>Hire Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (driver of filteredDrivers(); track driver.id) {
            <tr (click)="selectDriverRow(driver)" [class.selected]="selectedDriver()?.id === driver.id" style="cursor:pointer">
              <td class="name-cell">
                <div class="avatar">{{ driver.name.charAt(0) }}</div>
                {{ driver.name }}
              </td>
              <td>{{ driver.phone }}</td>
              <td>{{ driver.email || '—' }}</td>
              <td class="mono">{{ driver.licenseNumber || '—' }}</td>
              <td [class.expiring]="isExpiringSoon(driver.licenseExpiry)" [class.expired]="isExpired(driver.licenseExpiry)">
                {{ formatDate(driver.licenseExpiry) }}
              </td>
              <td><span class="type-badge" [class]="driver.type">{{ driver.type }}</span></td>
              <td>
                @if (driver.fleetName !== '—') {
                  <span class="fleet-badge">{{ driver.fleetName }}</span>
                } @else {
                  <span class="no-fleet">—</span>
                }
              </td>
              <td>{{ formatDate(driver.hireDate) }}</td>
              <td><span class="status-badge" [class]="driver.status">{{ driver.status }}</span></td>
              <td class="actions-cell">
                <button class="action-btn" title="View Profile" (click)="$event.stopPropagation(); viewDriver(driver)"><i class='bx bx-user'></i></button>
                <button class="action-btn" title="Edit" (click)="$event.stopPropagation(); editDriver(driver)"><i class='bx bx-edit'></i></button>
                @if (driver.status === 'active' || driver.status === 'available') {
                  <button class="action-btn deactivate" title="Deactivate" (click)="$event.stopPropagation(); deactivateDriver(driver)"><i class='bx bx-power-off'></i></button>
                } @else {
                  <button class="action-btn activate" title="Reactivate" (click)="$event.stopPropagation(); reactivateDriver(driver)"><i class='bx bx-check-circle'></i></button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

<!-- Add/Edit Driver Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal modal-lg" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ modalType() === 'add' ? 'Add Driver' : 'Edit Driver' }}</h3>
        <button class="close-btn" (click)="closeModal()"><i class='bx bx-x'></i></button>
      </div>
      <div class="modal-body">
        <div class="form-section">
          <h4>Basic Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" [ngModel]="driverForm().name" (ngModelChange)="updateField('name', $event)">
            </div>
            <div class="form-group">
              <label>Phone *</label>
              <input type="tel" [ngModel]="driverForm().phone" (ngModelChange)="updateField('phone', $event)" placeholder="(555) 123-4567">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" [ngModel]="driverForm().email" (ngModelChange)="updateField('email', $event)">
            </div>
            <div class="form-group">
              <label>Date of Birth</label>
              <input type="date" [ngModel]="driverForm().dateOfBirth" (ngModelChange)="updateField('dateOfBirth', $event)">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>License Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>CDL Number</label>
              <input type="text" [ngModel]="driverForm().licenseNumber" (ngModelChange)="updateField('licenseNumber', $event)">
            </div>
            <div class="form-group">
              <label>State</label>
              <input type="text" list="us-states" [ngModel]="driverForm().licenseState" (ngModelChange)="updateField('licenseState', $event.toUpperCase())" placeholder="Select state" maxlength="2" autocomplete="off">
            </div>
            <div class="form-group">
              <label>Expiry Date</label>
              <input type="date" [ngModel]="driverForm().licenseExpiry" (ngModelChange)="updateField('licenseExpiry', $event)">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Address</h4>
          <div class="form-group full-width">
            <label>Street Address</label>
            <input type="text" [ngModel]="driverForm().address" (ngModelChange)="updateField('address', $event)">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" [ngModel]="driverForm().city" (ngModelChange)="updateField('city', $event)">
            </div>
            <div class="form-group">
              <label>State</label>
              <input type="text" list="us-states" [ngModel]="driverForm().state" (ngModelChange)="updateField('state', $event.toUpperCase())" placeholder="Select state" maxlength="2" autocomplete="off">
            </div>
            <div class="form-group">
              <label>ZIP</label>
              <input type="text" [ngModel]="driverForm().zip" (ngModelChange)="updateField('zip', $event)">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Social Security</h4>
          <div class="form-row">
            <div class="form-group">
              <label>SSN</label>
              <input type="text" [ngModel]="driverForm().ssn" (ngModelChange)="updateField('ssn', $event)" placeholder="XXX-XX-XXXX" maxlength="11" autocomplete="off">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Organization, Fleet & Division</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Organization</label>
              <select [ngModel]="driverForm().organizationId" (ngModelChange)="updateField('organizationId', $event ? +$event : null)">
                <option [ngValue]="null">— No Organization —</option>
                @for (org of availableOrganizations(); track org.id) {
                  <option [ngValue]="org.id">{{ org.name }}</option>
                }
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Assigned Fleet</label>
              <select [ngModel]="driverForm().fleetId" (ngModelChange)="updateField('fleetId', $event ? +$event : null)">
                <option [ngValue]="null">— No Fleet —</option>
                @for (fleet of availableFleets(); track fleet.id) {
                  <option [ngValue]="fleet.id">{{ fleet.name }}</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label>Division</label>
              <select [ngModel]="driverForm().divisionId" (ngModelChange)="updateField('divisionId', $event ? +$event : null)" [disabled]="!driverForm().fleetId">
                <option [ngValue]="null">— No Division —</option>
                @for (div of availableDivisions(); track div.id) {
                  <option [ngValue]="div.id">{{ div.name }}</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label>Terminal</label>
              <select [ngModel]="driverForm().driverTerminalId" (ngModelChange)="updateField('driverTerminalId', $event ? +$event : null)" [disabled]="!driverForm().divisionId">
                <option [ngValue]="null">— No Terminal —</option>
                @for (term of availableDriverTerminals(); track term.id) {
                  <option [ngValue]="term.id">{{ term.name }}</option>
                }
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Truck Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Truck Number</label>
              <input type="text" [ngModel]="driverForm().truckNumber" (ngModelChange)="updateField('truckNumber', $event)" placeholder="e.g., T-1042">
            </div>
            <div class="form-group">
              <label>Truck Make</label>
              <input type="text" [ngModel]="driverForm().truckMake" (ngModelChange)="updateField('truckMake', $event)" placeholder="e.g., Freightliner">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Truck Model</label>
              <input type="text" [ngModel]="driverForm().truckModel" (ngModelChange)="updateField('truckModel', $event)" placeholder="e.g., Cascadia">
            </div>
            <div class="form-group">
              <label>Year</label>
              <input type="number" [ngModel]="driverForm().truckYear" (ngModelChange)="updateField('truckYear', $event ? +$event : null)" placeholder="e.g., 2024" min="1990" max="2030">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>VIN</label>
              <input type="text" [ngModel]="driverForm().truckVin" (ngModelChange)="updateField('truckVin', $event)" placeholder="Vehicle Identification Number" maxlength="17">
            </div>
            <div class="form-group">
              <label>Tag / Plate</label>
              <input type="text" [ngModel]="driverForm().truckTag" (ngModelChange)="updateField('truckTag', $event)" placeholder="License plate number">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Employment</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Driver Type</label>
              <select [ngModel]="driverForm().driverType" (ngModelChange)="updateField('driverType', $event)">
                <option value="company">Company</option>
                <option value="owner_operator">Owner Operator</option>
                <option value="lease">Lease</option>
                <option value="team">Team</option>
              </select>
            </div>
            <div class="form-group">
              <label>Hire Date</label>
              <input type="date" [ngModel]="driverForm().hireDate" (ngModelChange)="updateField('hireDate', $event)">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Pay Type</label>
              <select [ngModel]="driverForm().payType" (ngModelChange)="updateField('payType', $event)">
                <option value="mile">Per Mile</option>
                <option value="hour">Hourly</option>
                <option value="percentage">Percentage</option>
              </select>
            </div>
            <div class="form-group">
              <label>Pay Rate</label>
              <input type="number" [ngModel]="driverForm().payRate" (ngModelChange)="updateField('payRate', +$event)" step="0.01">
            </div>
          </div>
        </div>

        @if (driverForm().driverType === 'team') {
          <div class="form-section team-driver-section">
            <h4><i class='bx bx-group'></i> Team Driver Partner</h4>
            <div class="form-row">
              <div class="form-group">
                <label>Co-Driver</label>
                <select [ngModel]="driverForm().teamDriverId" (ngModelChange)="updateField('teamDriverId', $event ? +$event : null); updateField('teamDriverName', getDriverNameById(+$event))">
                  <option [ngValue]="null">-- Select co-driver --</option>
                  @for (d of drivers(); track d.id) {
                    @if (d.id !== editingId()) {
                      <option [ngValue]="d.id">{{ d.name }}</option>
                    }
                  }
                </select>
              </div>
              <div class="form-group">
                <label>Co-Driver Name</label>
                <input type="text" [ngModel]="driverForm().teamDriverName" (ngModelChange)="updateField('teamDriverName', $event)" placeholder="Auto-filled or enter manually">
              </div>
            </div>
          </div>
        }

        <div class="form-section">
          <h4>Emergency Contact</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Contact Name</label>
              <input type="text" [ngModel]="driverForm().emergencyContact" (ngModelChange)="updateField('emergencyContact', $event)">
            </div>
            <div class="form-group">
              <label>Contact Phone</label>
              <input type="tel" [ngModel]="driverForm().emergencyPhone" (ngModelChange)="updateField('emergencyPhone', $event)" placeholder="(555) 987-6543">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveDriver()" [disabled]="saving()">
          @if (saving()) {
            <i class='bx bx-loader-alt bx-spin'></i> Saving...
          } @else {
            <i class='bx bx-check'></i> Save
          }
        </button>
      </div>
    </div>
  </div>
}

<!-- Slide-out Details Panel (row click) -->
@if (selectedDriver()) {
  <div class="panel-overlay" (click)="closeProfile()"></div>
  <aside class="details-panel">
    <div class="panel-header">
      <h2>Driver Details</h2>
      <button class="close-btn" (click)="closeProfile()"><i class='bx bx-x'></i></button>
    </div>

    <div class="panel-avatar">
      <div class="big-avatar">{{ selectedDriver()!.name?.charAt(0) || '?' }}</div>
      <h3>{{ selectedDriver()!.name }}</h3>
      <span class="panel-status" [class]="'status-' + (selectedDriver()!.status || 'active')">{{ selectedDriver()!.status || 'active' }}</span>
    </div>

    <!-- Panel Tabs -->
    <div class="panel-tabs">
      <button class="panel-tab" [class.active]="detailTab() === 'overview'" (click)="detailTab.set('overview')">
        <i class='bx bx-info-circle'></i> Overview
      </button>
      <button class="panel-tab" [class.active]="detailTab() === 'pm'" (click)="detailTab.set('pm'); loadDriverPmDocs()">
        <i class='bx bx-wrench'></i> PM
      </button>
    </div>

    <!-- Overview Tab -->
    @if (detailTab() === 'overview') {
      <div class="panel-section">
        <h4>Contact</h4>
        <div class="detail-row"><span class="label">Phone</span><span>{{ selectedDriver()!.phone || '—' }}</span></div>
        <div class="detail-row"><span class="label">Email</span><span>{{ selectedDriver()!.email || '—' }}</span></div>
      </div>

      <div class="panel-section">
        <h4>License</h4>
        <div class="detail-row"><span class="label">Number</span><span class="mono">{{ selectedDriver()!.licenseNumber || '—' }}</span></div>
        <div class="detail-row"><span class="label">State</span><span>{{ selectedDriver()!.licenseState || '—' }}</span></div>
        <div class="detail-row">
          <span class="label">Expires</span>
          <span [class.expiring]="isExpiringSoon(selectedDriver()!.licenseExpiry)" [class.expired]="isExpired(selectedDriver()!.licenseExpiry)">
            {{ formatDate(selectedDriver()!.licenseExpiry) }}
          </span>
        </div>
        <div class="detail-row"><span class="label">Class</span><span>{{ selectedDriver()!.licenseClass || '—' }}</span></div>
      </div>

      <div class="panel-section">
        <h4>Employment</h4>
        <div class="detail-row"><span class="label">Type</span><span>{{ selectedDriver()!.type || '—' }}</span></div>
        <div class="detail-row"><span class="label">Hire Date</span><span>{{ formatDate(selectedDriver()!.hireDate) }}</span></div>
        <div class="detail-row"><span class="label">Fleet</span><span>{{ selectedDriver()!.fleetName || '—' }}</span></div>
      </div>

      <div class="panel-section">
        <h4>Compliance Summary</h4>
        @for (doc of complianceItems; track doc.key) {
          <div class="compliance-row">
            <span class="dot" [class]="getComplianceStatus(selectedDriver()!, doc.key)"></span>
            <span class="comp-label">{{ doc.label }}</span>
          </div>
        }
      </div>
    }

    <!-- PM Tab -->
    @if (detailTab() === 'pm') {
      <div class="panel-section">
        <div class="pm-header">
          <h4>Maintenance Records</h4>
        </div>
        @if (driverPmDocs().length === 0) {
          <div class="pm-empty">
            <i class='bx bx-wrench'></i>
            <p>No PM records yet</p>
          </div>
        } @else {
          @for (doc of driverPmDocs(); track doc.id) {
            <div class="pm-item">
              <div class="pm-icon"><i class='bx bx-wrench'></i></div>
              <div class="pm-info">
                <strong>{{ doc.documentName || doc.subCategory || 'PM Record' }}</strong>
                <span class="pm-meta">
                  {{ doc.documentNumber ? '#' + doc.documentNumber + ' · ' : '' }}
                  {{ doc.issueDate ? formatDate(doc.issueDate) : '' }}
                </span>
                @if (doc.expiryDate) {
                  <span class="pm-expiry" [class.expiring]="isExpiringSoon(doc.expiryDate)" [class.expired]="isExpired(doc.expiryDate)">
                    Exp: {{ formatDate(doc.expiryDate) }}
                  </span>
                }
              </div>
              <span class="pm-status" [class]="doc.status || 'active'">{{ doc.status || 'active' }}</span>
            </div>
          }
        }
      </div>
    }
  </aside>
}

<!-- Driver Profile Modal (icon click) -->
@if (profileDriver()) {
  <div class="modal-overlay" (click)="closeProfileModal()">
    <div class="modal modal-profile" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="profile-header-info">
          <div class="profile-avatar-lg">{{ profileDriver()!.name?.charAt(0) || 'D' }}</div>
          <div>
            <h3>{{ profileDriver()!.name }}</h3>
            <div class="profile-tags">
              <span class="type-badge" [class]="profileDriver()!.type">{{ profileDriver()!.type }}</span>
              <span class="status-badge" [class]="profileDriver()!.status">{{ profileDriver()!.status }}</span>
            </div>
          </div>
        </div>
        <button class="close-btn" (click)="closeProfileModal()"><i class='bx bx-x'></i></button>
      </div>

      <div class="profile-tabs">
        <button class="profile-tab" [class.active]="profileTab() === 'profile'" (click)="switchProfileTab('profile')">
          <i class='bx bx-user'></i> Profile
        </button>
        <button class="profile-tab" [class.active]="profileTab() === 'documents'" (click)="switchProfileTab('documents')">
          <i class='bx bx-file'></i> Documents
        </button>
      </div>

      <div class="modal-body">
        @if (profileTab() === 'profile') {
          <div class="profile-sections">
            <div class="profile-section-block">
              <h4>Contact</h4>
              <div class="profile-grid">
                <div class="profile-field"><span class="profile-label">Phone</span><span class="profile-value">{{ profileDriver()!.phone || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">Email</span><span class="profile-value">{{ profileDriver()!.email || '—' }}</span></div>
              </div>
            </div>

            <div class="profile-section-block">
              <h4>License</h4>
              <div class="profile-grid">
                <div class="profile-field"><span class="profile-label">CDL Number</span><span class="profile-value mono">{{ profileDriver()!.licenseNumber || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">State</span><span class="profile-value">{{ profileDriver()!.licenseState || '—' }}</span></div>
                <div class="profile-field">
                  <span class="profile-label">Expiry</span>
                  <span class="profile-value" [class.expiring]="isExpiringSoon(profileDriver()!.licenseExpiry)" [class.expired]="isExpired(profileDriver()!.licenseExpiry)">
                    {{ formatDate(profileDriver()!.licenseExpiry) }}
                  </span>
                </div>
                <div class="profile-field"><span class="profile-label">Class</span><span class="profile-value">{{ profileDriver()!.licenseClass || '—' }}</span></div>
              </div>
            </div>

            <div class="profile-section-block">
              <h4>Address</h4>
              <div class="profile-grid">
                <div class="profile-field full"><span class="profile-label">Street</span><span class="profile-value">{{ profileDriver()!.address || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">City</span><span class="profile-value">{{ profileDriver()!.city || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">State</span><span class="profile-value">{{ profileDriver()!.state || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">ZIP</span><span class="profile-value">{{ profileDriver()!.zip || '—' }}</span></div>
              </div>
            </div>

            <div class="profile-section-block">
              <h4>Employment</h4>
              <div class="profile-grid">
                <div class="profile-field"><span class="profile-label">Type</span><span class="profile-value">{{ profileDriver()!.type || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">Hire Date</span><span class="profile-value">{{ formatDate(profileDriver()!.hireDate) }}</span></div>
                <div class="profile-field"><span class="profile-label">Fleet</span><span class="profile-value">{{ profileDriver()!.fleetName || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">Pay</span><span class="profile-value">{{ profileDriver()!.payType || '—' }} — {{ profileDriver()!.payRate || '—' }}</span></div>
              </div>
            </div>

            <div class="profile-section-block">
              <h4>Emergency Contact</h4>
              <div class="profile-grid">
                <div class="profile-field"><span class="profile-label">Name</span><span class="profile-value">{{ profileDriver()!.emergencyContact || '—' }}</span></div>
                <div class="profile-field"><span class="profile-label">Phone</span><span class="profile-value">{{ profileDriver()!.emergencyPhone || '—' }}</span></div>
              </div>
            </div>

            <div class="profile-section-block">
              <h4>Compliance Summary</h4>
              <div class="compliance-grid">
                @for (item of complianceItems; track item.key) {
                  <div class="compliance-row">
                    <span class="dot" [class]="getComplianceStatus(profileDriver()!, item.key)"></span>
                    <span class="comp-label">{{ item.label }}</span>
                  </div>
                }
              </div>
            </div>
          </div>
        }

        @if (profileTab() === 'documents') {
          <div class="doc-list">
            @for (doc of driverDocuments(); track doc.type) {
              <div class="doc-item" [class]="doc.status">
                <div class="doc-icon"><i class='bx' [ngClass]="doc.icon"></i></div>
                <div class="doc-info">
                  <span class="doc-name">{{ doc.type }}</span>
                  @if (doc.number) { <span class="doc-number">{{ doc.number }}</span> }
                  @if (doc.expiry) { <span class="doc-expiry">Exp: {{ formatDate(doc.expiry) }}</span> }
                </div>
                <span class="doc-status-badge" [class]="doc.status">{{ getDocStatusLabel(doc.status) }}</span>
                <div class="doc-actions">
                  @if (doc.status !== 'missing') {
                    <button class="doc-action-btn" title="Preview" (click)="previewDocument(doc)">
                      <i class='bx bx-show'></i>
                    </button>
                  }
                  <label class="doc-action-btn" title="Upload">
                    <i class='bx bx-upload'></i>
                    <input type="file" hidden accept=".pdf,.jpg,.png,.doc,.docx" (change)="uploadDocument($event, doc)">
                  </label>
                  @if (doc.status !== 'missing') {
                    <button class="doc-action-btn archive" title="Archive" (click)="archiveDocument(doc)">
                      <i class='bx bx-archive-in'></i>
                    </button>
                  }
                </div>
              </div>
            } @empty {
              <div class="doc-empty">
                <i class='bx bx-file'></i>
                <p>Loading documents...</p>
              </div>
            }
          </div>
        }
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="editDriver(profileDriver()!); closeProfileModal()">
          <i class='bx bx-edit'></i> Edit Driver
        </button>
        <button class="btn btn-secondary" (click)="closeProfileModal()">Close</button>
      </div>
    </div>
  </div>
}

<!-- US States datalist -->
<datalist id="us-states">
  @for (s of usStates; track s.code) {
    <option [value]="s.code">{{ s.name }}</option>
  }
</datalist>
